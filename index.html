<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Galaxy Defender - –ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —à—É—Ç–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a0a2a, #1a1a3a);
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        
        .header {
            text-align: center;
            width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00aaff, #ff00ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0ff;
            margin-bottom: 20px;
        }
        
        .game-area {
            position: relative;
            width: 100%;
            aspect-ratio: 4/3;
            background: #000;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.3);
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #00aaff;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a0a0ff;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ffaa;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            width: 100%;
        }
        
        button {
            flex: 1;
            padding: 15px;
            font-size: 1.1rem;
            background: linear-gradient(45deg, #00aaff, #0088ff);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .instructions {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #ff00ff;
            margin-top: 20px;
            max-width: 600px;
        }
        
        .instructions h3 {
            color: #ff00ff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .instructions ul {
            list-style: none;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 3px solid #00aaff;
        }
        
        .bonus-panel {
            background: rgba(0, 50, 100, 0.5);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #00aaff;
            width: 100%;
            min-height: 60px;
        }
        
        .bonus-panel h4 {
            color: #00ffaa;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #0a0a2a, #1a1a3a);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #00aaff;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        
        .modal h2 {
            color: #00ffaa;
            margin-bottom: 20px;
        }
        
        .modal p {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .touch-indicator {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 170, 255, 0.3);
            border: 2px solid #00aaff;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .touch-indicator.active {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 10px;
            }
            
            .stat-value {
                font-size: 1.3rem;
            }
            
            .controls {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            .stat-value {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåå GALAXY DEFENDER</h1>
            <p class="subtitle">–ó–∞–∂–º–∏—Ç–µ –∫–æ—Ä–∞–±–ª—å –ø–∞–ª—å—Ü–µ–º –∏ —É–Ω–∏—á—Ç–æ–∂–∞–π—Ç–µ –≤—Ä–∞–≥–æ–≤!</p>
        </div>
        
        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
            <div class="touch-indicator" id="touchIndicator"></div>
        </div>
        
        <div class="stats-panel">
            <div class="stat-item">
                <span class="stat-label">–û–ß–ö–ò</span>
                <span class="stat-value" id="score">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">–í–û–õ–ù–ê</span>
                <span class="stat-value" id="wave">1</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">–ñ–ò–ó–ù–ò</span>
                <span class="stat-value" id="lives">3</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">–ü–û–ü–ê–î–ê–ù–ò–Ø</span>
                <span class="stat-value" id="hits">0</span>
            </div>
        </div>
        
        <div class="bonus-panel">
            <h4>üéØ –ê–ö–¢–ò–í–ù–´–ï –ë–û–ù–£–°–´</h4>
            <div id="bonuses">
                <div class="bonus-item">
                    <span class="bonus-icon">üö´</span>
                    <span>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤</span>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="showInstructions()">üìñ –ò–ù–°–¢–†–£–ö–¶–ò–ò</button>
            <button onclick="toggleSound()" id="soundBtn">üîä –ó–í–£–ö –í–ö–õ</button>
        </div>
        
        <div class="instructions">
            <h3>üéÆ –ö–ê–ö –ò–ì–†–ê–¢–¨:</h3>
            <ul>
                <li>–ó–∞–∂–º–∏—Ç–µ –∫–æ—Ä–∞–±–ª—å –ø–∞–ª—å—Ü–µ–º/–º—ã—à—å—é –∏ –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –ø–æ —ç–∫—Ä–∞–Ω—É</li>
                <li>–ü—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–æ—Ä–∞–±–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–µ–ª—è–µ—Ç</li>
                <li>–£–Ω–∏—á—Ç–æ–∂–∞–π—Ç–µ –≤—Ä–∞–≥–æ–≤, –∏–∑–±–µ–≥–∞–π—Ç–µ –∏—Ö –≤—ã—Å—Ç—Ä–µ–ª–æ–≤</li>
                <li>5 –ø–æ–ø–∞–¥–∞–Ω–∏–π ‚Üí –¢—Ä–æ–π–Ω–æ–π –≤—ã—Å—Ç—Ä–µ–ª (3 —Å–µ–∫)</li>
                <li>10 –ø–æ–ø–∞–¥–∞–Ω–∏–π ‚Üí –í–æ—Å—å–º–∏–∑–∞—Ä—è–¥–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª (5 —Å–µ–∫)</li>
                <li>–ù–∞–∂–º–∏—Ç–µ ESC –∏–ª–∏ –≤–Ω–µ –∏–≥—Ä—ã –¥–ª—è –ø–∞—É–∑—ã</li>
            </ul>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <h2>üéÆ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–ì–†–ï</h2>
            <p><strong>Galaxy Defender</strong> - –∫–æ—Å–º–∏—á–µ—Å–∫–∏–π —à—É—Ç–µ—Ä —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–∞—Å–∞–Ω–∏–µ–º!</p>
            
            <h3>üéØ –£–ü–†–ê–í–õ–ï–ù–ò–ï:</h3>
            <p>‚Ä¢ –ó–∞–∂–º–∏—Ç–µ –∫–æ—Ä–∞–±–ª—å –ø–∞–ª—å—Ü–µ–º/–º—ã—à—å—é –∏ –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ</p>
            <p>‚Ä¢ –ü—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –∫–æ—Ä–∞–±–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–µ–ª—è–µ—Ç</p>
            <p>‚Ä¢ –û—Ç–ø—É—Å—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å —Å—Ç—Ä–µ–ª—å–±—É</p>
            
            <h3>‚ö° –ë–û–ù–£–°–´:</h3>
            <p>‚Ä¢ 5 –ø–æ–ø–∞–¥–∞–Ω–∏–π ‚Üí –¢—Ä–æ–π–Ω–æ–π –≤—ã—Å—Ç—Ä–µ–ª (3 —Å–µ–∫—É–Ω–¥—ã)</p>
            <p>‚Ä¢ 10 –ø–æ–ø–∞–¥–∞–Ω–∏–π ‚Üí –í–æ—Å—å–º–∏–∑–∞—Ä—è–¥–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª (5 —Å–µ–∫—É–Ω–¥)</p>
            
            <h3>üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô:</h3>
            <p>‚Ä¢ ESC –∏–ª–∏ –∫–∞—Å–∞–Ω–∏–µ –≤–Ω–µ –∏–≥—Ä—ã - –ø–∞—É–∑–∞</p>
            <p>‚Ä¢ –ö–Ω–æ–ø–∫–∞ "–ó–í–£–ö" - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫</p>
            
            <button onclick="hideInstructions()" style="margin-top: 20px;">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£!</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ Game Over -->
    <div class="modal" id="gameOverModal">
        <div class="modal-content">
            <h2>üíÄ –ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</h2>
            <p id="gameOverReason">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ!</p>
            
            <div style="margin: 20px 0; font-size: 1.2rem;">
                <p>üèÜ –§–ò–ù–ê–õ–¨–ù–´–ô –°–ß–ï–¢: <span id="finalScore" style="color: #00ffaa;">0</span></p>
                <p>üåä –î–û–°–¢–ò–ì–ù–£–¢–ê–Ø –í–û–õ–ù–ê: <span id="finalWave" style="color: #00ffaa;">1</span></p>
            </div>
            
            <button onclick="restartGame()">üîÑ –ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û</button>
        </div>
    </div>
    
    <script>
        // ======================= –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï =======================
        const CANVAS_WIDTH = 800;
        const CANVAS_HEIGHT = 600;
        const FPS = 60;
        const COLORS = {
            BLUE: '#00aaff',
            RED: '#ff5555',
            GREEN: '#55ff55',
            YELLOW: '#ffff55',
            PURPLE: '#ff55ff',
            WHITE: '#ffffff',
            ORANGE: '#ffaa00'
        };
        
        let canvas, ctx;
        let game;
        let soundEnabled = true;
        // ======================= –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô =======================
        let images = {
            player: null,
            enemyNormal: null,
            enemyStrong: null,
            bullet: null
        };

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        function loadImages() {
            return new Promise((resolve) => {
                let loaded = 0;
                const total = Object.keys(images).length;
                
                function imageLoaded() {
                    loaded++;
                    if (loaded === total) {
                        console.log('–í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                        resolve();
                    }
                }
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç—ã Image
                images.player = new Image();
                images.enemyNormal = new Image();
                images.enemyStrong = new Image();
                
                // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ src
                images.player.onload = imageLoaded;
                images.player.onerror = () => {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞');
                    images.player = null;
                    imageLoaded();
                };
                
                images.enemyNormal.onload = imageLoaded;
                images.enemyNormal.onerror = () => {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ–≥–æ –≤—Ä–∞–≥–∞');
                    images.enemyNormal = null;
                    imageLoaded();
                };
                
                images.enemyStrong.onload = imageLoaded;
                images.enemyStrong.onerror = () => {
                    console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∏–ª—å–Ω–æ–≥–æ –≤—Ä–∞–≥–∞');
                    images.enemyStrong = null;
                    imageLoaded();
                };
                
                // –¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—É—Ç–∏
                images.player.src = 'player.png';
                images.enemyNormal.src = 'enemyl.png';
                images.enemyStrong.src = 'enemy2.png';
                
                // –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–æ–≤, —Å—Ä–∞–∑—É —Ä–µ–∑–æ–ª–≤–∏–º
                if (total === 0) {
                    resolve();
                }
            });
        }
                
        // ======================= –°–ò–°–¢–ï–ú–ê –ó–í–£–ö–û–í =======================
        class AudioSystem {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.music = null;
                this.musicPlaying = false;
                
                this.init();
            }
            
            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.createSounds();
                    this.createMusic();
                } catch (e) {
                    console.log('–ê—É–¥–∏–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:', e);
                }
            }
            
            createSounds() {
                // –ü—Ä–æ—Å—Ç—ã–µ –∑–≤—É–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Web Audio API
                this.sounds = {
                    shoot: this.createTone(800, 0.1, 'sawtooth'),
                    enemyShoot: this.createTone(400, 0.1, 'square'),
                    explosion: this.createExplosionSound(),
                    hit: this.createTone(300, 0.05, 'sine'),
                    bonus: this.createBonusSound(),
                    wave: this.createWaveSound(),
                    gameOver: this.createGameOverSound()
                };
            }
            
            createTone(frequency, duration, type = 'sine') {
                return () => {
                    if (!this.audioContext || !soundEnabled) return;
                    
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.value = frequency;
                    oscillator.type = type;
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                };
            }
            
            createExplosionSound() {
                return () => {
                    if (!this.audioContext || !soundEnabled) return;
                    
                    for (let i = 0; i < 5; i++) {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);
                        
                        oscillator.frequency.value = 100 + Math.random() * 200;
                        oscillator.type = 'sawtooth';
                        
                        const startTime = this.audioContext.currentTime + i * 0.05;
                        gainNode.gain.setValueAtTime(0.2, startTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                        
                        oscillator.start(startTime);
                        oscillator.stop(startTime + 0.3);
                    }
                };
            }
            
            createBonusSound() {
                return () => {
                    if (!this.audioContext || !soundEnabled) return;
                    
                    const frequencies = [523.25, 659.25, 783.99]; // C5, E5, G5
                    
                    frequencies.forEach((freq, i) => {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        const startTime = this.audioContext.currentTime + i * 0.1;
                        gainNode.gain.setValueAtTime(0.15, startTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.2);
                        
                        oscillator.start(startTime);
                        oscillator.stop(startTime + 0.2);
                    });
                };
            }
            
            createWaveSound() {
                return () => {
                    if (!this.audioContext || !soundEnabled) return;
                    
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.5);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 0.5);
                };
            }
            
            createGameOverSound() {
                return () => {
                    if (!this.audioContext || !soundEnabled) return;
                    
                    const frequencies = [392, 349.23, 329.63, 293.66]; // G4, F4, E4, D4
                    
                    frequencies.forEach((freq, i) => {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);
                        
                        oscillator.frequency.value = freq;
                        oscillator.type = 'sine';
                        
                        const startTime = this.audioContext.currentTime + i * 0.3;
                        gainNode.gain.setValueAtTime(0.2, startTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
                        
                        oscillator.start(startTime);
                        oscillator.stop(startTime + 0.5);
                    });
                };
            }
            
            createMusic() {
                // –ü—Ä–æ—Å—Ç–∞—è —Ñ–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
                this.music = () => {
                    if (!this.audioContext || !soundEnabled || this.musicPlaying) return;
                    
                    this.musicPlaying = true;
                    const sequence = [
                        { note: 523.25, duration: 0.5 }, // C5
                        { note: 587.33, duration: 0.5 }, // D5
                        { note: 659.25, duration: 0.5 }, // E5
                        { note: 698.46, duration: 0.5 }, // F5
                        { note: 783.99, duration: 0.5 }, // G5
                        { note: 880.00, duration: 0.5 }, // A5
                        { note: 987.77, duration: 0.5 }, // B5
                        { note: 1046.50, duration: 1.0 }  // C6
                    ];
                    
                    let time = this.audioContext.currentTime;
                    
                    sequence.forEach((step, index) => {
                        const oscillator = this.audioContext.createOscillator();
                        const gainNode = this.audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(this.audioContext.destination);
                        
                        oscillator.frequency.value = step.note;
                        oscillator.type = 'sine';
                        
                        gainNode.gain.setValueAtTime(0.05, time);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, time + step.duration);
                        
                        oscillator.start(time);
                        oscillator.stop(time + step.duration);
                        
                        time += step.duration;
                    });
                    
                    // –ü–æ–≤—Ç–æ—Ä—è–µ–º –º—É–∑—ã–∫—É —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        this.musicPlaying = false;
                        if (soundEnabled) {
                            this.music();
                        }
                    }, 4000);
                };
            }
            
            play(soundName) {
                if (this.sounds[soundName]) {
                    this.sounds[soundName]();
                }
            }
            
            startMusic() {
                if (this.music) {
                    this.music();
                }
            }
            
            stopMusic() {
                this.musicPlaying = false;
            }
        }
        
        // ======================= –ö–õ–ê–°–°–´ –ò–ì–†–´ =======================
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.size = Math.random() * 4 + 2;
                this.speedX = Math.random() * 6 - 3;
                this.speedY = Math.random() * 6 - 3;
                this.life = 1.0;
                this.decay = 0.02;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= this.decay;
                return this.life <= 0;
            }
            
            draw() {
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1.0;
            }
        }
        
        class Bullet {
            constructor(x, y, speedX, speedY, color, isPlayer = true) {
                this.x = x;
                this.y = y;
                this.speedX = speedX;
                this.speedY = speedY;
                this.color = color;
                this.width = isPlayer ? 4 : 3;
                this.height = isPlayer ? 12 : 8;
                this.active = true;
                this.isPlayer = isPlayer;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                if (this.y < -20 || this.y > CANVAS_HEIGHT + 20 ||
                    this.x < -20 || this.x > CANVAS_WIDTH + 20) {
                    this.active = false;
                }
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);
                
                // –≠—Ñ—Ñ–µ–∫—Ç —Å–≤–µ—á–µ–Ω–∏—è –¥–ª—è –ø—É–ª—å –∏–≥—Ä–æ–∫–∞
                if (this.isPlayer) {
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = this.color;
                    ctx.fillRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);
                    ctx.shadowBlur = 0;
                }
            }
        }
        
        class Enemy {
            constructor(x, y, type = 'normal') {
                this.x = x;
                this.y = y;
                this.type = type;
                this.width = type === 'strong' ? 65 : 55;
                this.height = type === 'strong' ? 60 : 40;
                this.speed = type === 'strong' ? 0.8 : 1.5;
                this.color = type === 'strong' ? COLORS.PURPLE : COLORS.RED;
                this.health = type === 'strong' ? 3 : 1;
                this.lastShotTime = 0;
                this.angle = 0;
                this.pulse = 0;
            }
            
            takeDamage() {
                this.health--;
                return this.health <= 0;
            }
            
            update() {
                this.y += this.speed;
                this.angle += 0.05;
                this.pulse = Math.sin(this.angle) * 0.1 + 1;
                
                return this.y > CANVAS_HEIGHT + 50;
            }
            
            shoot() {
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å—Ç—Ä–µ–ª—å–±—ã –¥–ª—è –≤—Ä–∞–≥–æ–≤
                const now = Date.now();
                if (now - this.lastShotTime < 2800) { // 1 –≤—ã—Å—Ç—Ä–µ–ª –≤ —Å–µ–∫—É–Ω–¥—É –¥–ª—è –≤—Ä–∞–≥–æ–≤
                    return null;
                }
                
                this.lastShotTime = now;
                
                if (game.audio) {
                    game.audio.play('enemyShoot');
                }
                
                return new Bullet(
                    this.x,
                    this.y + this.height/2,
                    0,
                    4,
                    this.type === 'strong' ? COLORS.ORANGE : COLORS.YELLOW,
                    false
                );
            }

            
            draw() {
                // –£–î–ê–õ–ò–¢–ï –≤–µ—Å—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –º–µ—Ç–æ–¥–∞ draw() –∏ –í–°–¢–ê–í–¨–¢–ï —ç—Ç–æ—Ç:
                
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.pulse, this.pulse);
                
                if (this.type === 'strong' && images.enemyStrong) {
                    // –†–∏—Å—É–µ–º —Å–ø—Ä–∞–π—Ç —Å–∏–ª—å–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
                    ctx.drawImage(
                        images.enemyStrong,
                        -this.width/2,
                        -this.height/2,
                        this.width,
                        this.height
                    );
                } else if (this.type === 'normal' && images.enemyNormal) {
                    // –†–∏—Å—É–µ–º —Å–ø—Ä–∞–π—Ç –æ–±—ã—á–Ω–æ–≥–æ –≤—Ä–∞–≥–∞
                    ctx.drawImage(
                        images.enemyNormal,
                        -this.width/2,
                        -this.height/2,
                        this.width,
                        this.height
                    );
                } else {
                    // –§–æ–ª–±—ç–∫ –Ω–∞ —Å—Ç–∞—Ä—É—é –æ—Ç—Ä–∏—Å–æ–≤–∫—É
                    // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–ø—É—Å
                    ctx.fillStyle = this.color;
                    ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
                    
                    // –î–µ—Ç–∞–ª–∏
                    ctx.fillStyle = this.type === 'strong' ? COLORS.ORANGE : COLORS.YELLOW;
                    ctx.fillRect(-this.width/4, -this.height/4, this.width/2, this.height/2);
                    
                    // –û–∫–∞–Ω—Ç–æ–≤–∫–∞
                    ctx.strokeStyle = COLORS.WHITE;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(-this.width/2, -this.height/2, this.width, this.height);
                    
                    // –î–ª—è —Å–∏–ª—å–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤ - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
                    if (this.type === 'strong') {
                        ctx.fillStyle = COLORS.RED;
                        ctx.fillRect(-10, -15, 20, 10);
                        ctx.fillRect(-10, 5, 20, 10);
                    }
                }
                
                ctx.restore();
                
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–¥–æ—Ä–æ–≤—å—è –¥–ª—è —Å–∏–ª—å–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤ (–æ—Å—Ç–∞–≤–ª—è–µ–º)
                if (this.type === 'strong' && this.health < 3) {
                    ctx.fillStyle = COLORS.RED;
                    ctx.fillRect(this.x - 20, this.y - 30, 40 * (this.health / 3), 5);
                    ctx.strokeStyle = COLORS.WHITE;
                    ctx.lineWidth = 1;
                    ctx.strokeRect(this.x - 20, this.y - 30, 40, 5);
                }
            }
        }
        
        class Player {
            constructor(game) {
                this.game = game;
                this.x = CANVAS_WIDTH / 2;
                this.y = CANVAS_HEIGHT - 80;
                this.width = 60;
                this.height = 40;
                this.speed = 5;
                this.lives = 3;
                this.score = 0;
                this.hitCounter = 0;
                this.shootTimer = 0;
                this.shootInterval = 10;
                this.tripleShotActive = false;
                this.tripleShotTimer = 0;
                this.octaShotActive = false;
                this.octaShotTimer = 0;
                this.isTouching = false;
                this.touchX = 0;
                this.touchY = 0;
                this.enginePulse = 0;
                this.lastShotTime = 0; 
            }
            
            takeDamage() {
                this.lives--;
                return this.lives <= 0;
            }
            
            update() {
                                
                    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö —ç–∫—Ä–∞–Ω–∞
                    this.x = Math.max(this.width/2, Math.min(CANVAS_WIDTH - this.width/2, this.x));
                    this.y = Math.max(this.height/2, Math.min(CANVAS_HEIGHT - this.height/2, this.y));
                    
                    // –°—Ç—Ä–µ–ª—å–±–∞ –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏
                    this.shootTimer++;
                    if (this.shootTimer >= this.shootInterval) {
                        this.shoot();
                        this.shootTimer = 0;
                    }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–æ–≤ –±–æ–Ω—É—Å–æ–≤
                if (this.tripleShotActive) {
                    this.tripleShotTimer--;
                    if (this.tripleShotTimer <= 0) {
                        this.tripleShotActive = false;
                    }
                }
                
                if (this.octaShotActive) {
                    this.octaShotTimer--;
                    if (this.octaShotTimer <= 0) {
                        this.octaShotActive = false;
                    }
                }
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π
                this.enginePulse += 0.2;
            }
            
            shoot() {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –≤—ã—Å—Ç—Ä–µ–ª–∞–º–∏ (300ms = ~3 –≤—ã—Å—Ç—Ä–µ–ª–∞ –≤ —Å–µ–∫—É–Ω–¥—É)
                const now = Date.now();
                if (now - this.lastShotTime < 300) {
                    return;
                }
                
                this.lastShotTime = now;
                
                if (game.audio) {
                    game.audio.play('shoot');
                }
                
                if (this.octaShotActive) {
                    // –í–æ—Å—å–º–∏–∑–∞—Ä—è–¥–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª
                    const angles = [0, 45, 90, 135, 180, 225, 270, 315];
                    angles.forEach(angle => {
                        const rad = angle * Math.PI / 180;
                        this.game.bullets.push(new Bullet(
                            this.x,
                            this.y - this.height/2,
                            Math.sin(rad) * 8,
                            -8,
                            COLORS.GREEN,
                            true
                        ));
                    });
                } else if (this.tripleShotActive) {
                    // –¢—Ä–æ–π–Ω–æ–π –≤—ã—Å—Ç—Ä–µ–ª
                    this.game.bullets.push(new Bullet(this.x - 10, this.y - this.height/2, 0, -8, COLORS.BLUE, true));
                    this.game.bullets.push(new Bullet(this.x, this.y - this.height/2, 0, -8, COLORS.BLUE, true));
                    this.game.bullets.push(new Bullet(this.x + 10, this.y - this.height/2, 0, -8, COLORS.BLUE, true));
                } else {
                    // –û–±—ã—á–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª
                    this.game.bullets.push(new Bullet(this.x, this.y - this.height/2, 0, -8, COLORS.BLUE, true));
                }
            }
            
            draw() {
                // –£–î–ê–õ–ò–¢–ï –≤–µ—Å—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –º–µ—Ç–æ–¥–∞ draw() –∏ –í–°–¢–ê–í–¨–¢–ï —ç—Ç–æ—Ç:
                
                if (images.player) {
                    // –†–∏—Å—É–µ–º —Å–ø—Ä–∞–π—Ç –∏–≥—Ä–æ–∫–∞
                    ctx.save();
                    ctx.translate(this.x, this.y);
                    
                    // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–≤–æ—Ä–æ—Ç –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏
                    // ctx.rotate(angle);
                    
                    // –†–∏—Å—É–µ–º —Å–ø—Ä–∞–π—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É
                    ctx.drawImage(
                        images.player,
                        -this.width/2,
                        -this.height/2,
                        this.width,
                        this.height
                    );
                    
                    // –≠—Ñ—Ñ–µ–∫—Ç –¥–≤–∏–≥–∞—Ç–µ–ª–µ–π (–æ—Å—Ç–∞–≤–ª—è–µ–º –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–ø—Ä–∞–π—Ç)
                    if (this.isTouching) {
                        const engineSize = 15 + Math.sin(this.enginePulse) * 5;
                        ctx.fillStyle = COLORS.ORANGE;
                        ctx.fillRect(-8, this.height/2 - 5, 16, engineSize);
                    }
                    
                    ctx.restore();
                } else {
                    // –§–æ–ª–±—ç–∫ –Ω–∞ —Å—Ç–∞—Ä—É—é –æ—Ç—Ä–∏—Å–æ–≤–∫—É, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
                    // –î–≤–∏–≥–∞—Ç–µ–ª–∏
                    const engineSize = 15 + Math.sin(this.enginePulse) * 5;
                    ctx.fillStyle = COLORS.ORANGE;
                    ctx.fillRect(this.x - 8, this.y + this.height/2 - 5, 16, engineSize);
                    ctx.fillStyle = COLORS.YELLOW;
                    ctx.fillRect(this.x - 6, this.y + this.height/2 - 3, 12, engineSize - 4);
                    
                    // –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ—Ä–ø—É—Å
                    ctx.fillStyle = COLORS.BLUE;
                    ctx.fillRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);
                    
                    // –ö–∞–±–∏–Ω–∞
                    ctx.fillStyle = '#a0e0ff';
                    ctx.fillRect(this.x - 10, this.y - 20, 20, 15);
                    
                    // –ö—Ä—ã–ª—å—è
                    ctx.fillStyle = COLORS.BLUE;
                    ctx.fillRect(this.x - 30, this.y - 5, 20, 10);
                    ctx.fillRect(this.x + 10, this.y - 5, 20, 10);
                    
                    // –û–∫–∞–Ω—Ç–æ–≤–∫–∞
                    ctx.strokeStyle = COLORS.WHITE;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(this.x - this.width/2, this.y - this.height/2, this.width, this.height);
                }
                
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—Å–∞–Ω–∏—è (–æ—Å—Ç–∞–≤–ª—è–µ–º)
                if (this.isTouching) {
                    ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.width/2 + 5, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
        }
        
        class Game {
            constructor() {
                this.canvas = document.getElementById('gameCanvas');
                this.canvas.width = CANVAS_WIDTH;
                this.canvas.height = CANVAS_HEIGHT;
                ctx = this.canvas.getContext('2d');
                
                this.player = new Player(this);
                this.enemies = [];
                this.bullets = [];
                this.enemyBullets = [];
                this.particles = [];
                this.stars = [];
                
                this.wave = 1;
                this.enemiesPerWave = 6;
                this.enemiesSpawned = 0;
                this.spawnTimer = 0;
                
                this.gameOver = false;
                this.paused = false;
                this.lastTime = 0;
                this.frameCount = 0;
                
                this.audio = new AudioSystem();
                
                this.initStars();
                this.setupEventListeners();
                this.gameLoop(0);
                
            }
            
            initStars() {
                for (let i = 0; i < 100; i++) {
                    this.stars.push({
                        x: Math.random() * CANVAS_WIDTH,
                        y: Math.random() * CANVAS_HEIGHT,
                        size: Math.random() * 2 + 0.5,
                        speed: Math.random() * 0.5 + 0.2,
                        brightness: Math.random() * 0.5 + 0.5
                    });
                }
            }
            
            setupEventListeners() {
                const canvas = this.canvas;
                const touchIndicator = document.getElementById('touchIndicator');
                
                // –°–µ–Ω—Å–æ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    
                    this.player.isTouching = true;
                    this.player.touchX = (touch.clientX - rect.left) * scaleX;
                    this.player.touchY = (touch.clientY - rect.top) * scaleY;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—Å–∞–Ω–∏—è
                    touchIndicator.style.left = (touch.clientX - 20) + 'px';
                    touchIndicator.style.top = (touch.clientY - 20) + 'px';
                    touchIndicator.classList.add('active');
                });
                
                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    
                    // –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –¥–≤–∏–≥–∞–µ–º –∫–æ—Ä–∞–±–ª—å –∫ —Ç–æ—á–∫–µ –∫–∞—Å–∞–Ω–∏—è
                    const targetX = (touch.clientX - rect.left) * scaleX;
                    const targetY = (touch.clientY - rect.top) * scaleY;
                    
                    // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏
                    this.player.x += (targetX - this.player.x) * 0.2;
                    this.player.y += (targetY - this.player.y) * 0.2;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
                    touchIndicator.style.left = (touch.clientX - 20) + 'px';
                    touchIndicator.style.top = (touch.clientY - 20) + 'px';
                });
                
                canvas.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    this.player.isTouching = false;
                    touchIndicator.classList.remove('active');
                });
                
                // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
                canvas.addEventListener('mousedown', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    const scaleX = canvas.width / rect.width;
                    const scaleY = canvas.height / rect.height;
                    
                    this.player.isTouching = true;
                    this.player.touchX = (e.clientX - rect.left) * scaleX;
                    this.player.touchY = (e.clientY - rect.top) * scaleY;
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—Å–∞–Ω–∏—è
                    touchIndicator.style.left = (e.clientX - 20) + 'px';
                    touchIndicator.style.top = (e.clientY - 20) + 'px';
                    touchIndicator.classList.add('active');
                });
                
                canvas.addEventListener('mousemove', (e) => {
                    if (this.player.isTouching) {
                        const rect = canvas.getBoundingClientRect();
                        const scaleX = canvas.width / rect.width;
                        const scaleY = canvas.height / rect.height;
                        
                        // –ù–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –¥–≤–∏–≥–∞–µ–º –∫–æ—Ä–∞–±–ª—å –∫ —Ç–æ—á–∫–µ –º—ã—à–∏
                        const targetX = (e.clientX - rect.left) * scaleX;
                        const targetY = (e.clientY - rect.top) * scaleY;
                        
                        // –ü–ª–∞–≤–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ –∫ —Ü–µ–ª–∏
                        this.player.x += (targetX - this.player.x) * 0.2;
                        this.player.y += (targetY - this.player.y) * 0.2;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
                        touchIndicator.style.left = (e.clientX - 20) + 'px';
                        touchIndicator.style.top = (e.clientY - 20) + 'px';
                    }
                });
                
                canvas.addEventListener('mouseup', (e) => {
                    this.player.isTouching = false;
                    touchIndicator.classList.remove('active');
                });
                
                canvas.addEventListener('mouseleave', (e) => {
                    this.player.isTouching = false;
                    touchIndicator.classList.remove('active');
                });
                
                // –ü–∞—É–∑–∞ –ø–æ ESC
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.paused = !this.paused;
                        if (!this.paused) {
                            this.gameLoop(0);
                        }
                    }
                });
                
                // –ü–∞—É–∑–∞ –ø—Ä–∏ –∫–∞—Å–∞–Ω–∏–∏ –≤–Ω–µ –∏–≥—Ä—ã
                document.addEventListener('click', (e) => {
                    if (!canvas.contains(e.target) && e.target !== canvas) {
                        this.paused = !this.paused;
                        if (!this.paused) {
                            this.gameLoop(0);
                        }
                    }
                });
            }
            
            spawnEnemy() {
                const x = Math.random() * (CANVAS_WIDTH - 60) + 30;
                const type = Math.random() < 0.3 ? 'strong' : 'normal';
                this.enemies.push(new Enemy(x, -50, type));
                this.enemiesSpawned++;
            }
            
            update() {
                if (this.gameOver || this.paused) return;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥–Ω–æ–≥–æ —Ñ–æ–Ω–∞
                this.stars.forEach(star => {
                    star.y += star.speed;
                    if (star.y > CANVAS_HEIGHT) {
                        star.y = 0;
                        star.x = Math.random() * CANVAS_WIDTH;
                    }
                });
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
                this.player.update();
                
                // –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤
                this.spawnTimer++;
                if (this.enemiesSpawned < this.wave * this.enemiesPerWave && 
                    this.spawnTimer > 60 && 
                    this.enemies.length < 10) {
                    this.spawnEnemy();
                    this.spawnTimer = 0;
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
                for (let i = this.enemies.length - 1; i >= 0; i--) {
                    const enemy = this.enemies[i];
                    
                    if (enemy.update()) {
                        this.enemies.splice(i, 1);
                        continue;
                    }
                    
                    // –°—Ç—Ä–µ–ª—å–±–∞ –≤—Ä–∞–≥–æ–≤
                    const bullet = enemy.shoot();
                    if (bullet) {
                        this.enemyBullets.push(bullet);
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –ø—É–ª—è–º–∏ –∏–≥—Ä–æ–∫–∞
                    for (let j = this.bullets.length - 1; j >= 0; j--) {
                        const bullet = this.bullets[j];
                        
                        if (bullet.x > enemy.x - enemy.width/2 && 
                            bullet.x < enemy.x + enemy.width/2 &&
                            bullet.y > enemy.y - enemy.height/2 && 
                            bullet.y < enemy.y + enemy.height/2) {
                            
                            if (enemy.takeDamage()) {
                                // –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–∞
                                this.player.score += enemy.type === 'strong' ? 50 : 20;
                                this.player.hitCounter++;
                                
                                if (this.audio) {
                                    this.audio.play('explosion');
                                }
                                
                                // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤–∑—Ä—ã–≤–∞
                                for (let k = 0; k < 20; k++) {
                                    this.particles.push(new Particle(
                                        enemy.x,
                                        enemy.y,
                                        enemy.type === 'strong' ? COLORS.PURPLE : COLORS.RED
                                    ));
                                }
                                
                                this.enemies.splice(i, 1);
                                
                                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–æ–Ω—É—Å–æ–≤
                                if (this.player.hitCounter === 5) {
                                    this.player.tripleShotActive = true;
                                    this.player.tripleShotTimer = 180; // 3 —Å–µ–∫—É–Ω–¥—ã –ø—Ä–∏ 60 FPS
                                    
                                    if (this.audio) {
                                        this.audio.play('bonus');
                                    }
                                }
                                
                                if (this.player.hitCounter === 10) {
                                    this.player.octaShotActive = true;
                                    this.player.octaShotTimer = 300; // 5 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ 60 FPS
                                    
                                    if (this.audio) {
                                        this.audio.play('bonus');
                                    }
                                }
                            } else {
                                if (this.audio) {
                                    this.audio.play('hit');
                                }
                            }
                            
                            this.bullets.splice(j, 1);
                            break;
                        }
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
                    if (this.player.x > enemy.x - enemy.width/2 && 
                        this.player.x < enemy.x + enemy.width/2 &&
                        this.player.y > enemy.y - enemy.height/2 && 
                        this.player.y < enemy.y + enemy.height/2) {
                        
                        if (this.player.takeDamage()) {
                            this.gameOver = true;
                            this.showGameOver();
                            return;
                        }
                        
                        if (this.audio) {
                            this.audio.play('explosion');
                        }
                        
                        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤–∑—Ä—ã–≤–∞
                        for (let k = 0; k < 15; k++) {
                            this.particles.push(new Particle(
                                enemy.x,
                                enemy.y,
                                enemy.type === 'strong' ? COLORS.PURPLE : COLORS.RED
                            ));
                        }
                        
                        this.enemies.splice(i, 1);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å –∏–≥—Ä–æ–∫–∞
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    this.bullets[i].update();
                    if (!this.bullets[i].active) {
                        this.bullets.splice(i, 1);
                    }
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å –≤—Ä–∞–≥–æ–≤
                for (let i = this.enemyBullets.length - 1; i >= 0; i--) {
                    const bullet = this.enemyBullets[i];
                    bullet.update();
                    
                    if (!bullet.active) {
                        this.enemyBullets.splice(i, 1);
                        continue;
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
                    if (bullet.x > this.player.x - this.player.width/2 && 
                        bullet.x < this.player.x + this.player.width/2 &&
                        bullet.y > this.player.y - this.player.height/2 && 
                        bullet.y < this.player.y + this.player.height/2) {
                        
                        if (this.player.takeDamage()) {
                            this.gameOver = true;
                            this.showGameOver();
                            return;
                        }
                        
                        if (this.audio) {
                            this.audio.play('hit');
                        }
                        
                        this.enemyBullets.splice(i, 1);
                        
                        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –≤–∑—Ä—ã–≤–∞
                        for (let k = 0; k < 10; k++) {
                            this.particles.push(new Particle(
                                bullet.x,
                                bullet.y,
                                COLORS.YELLOW
                            ));
                        }
                    }
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    if (this.particles[i].update()) {
                        this.particles.splice(i, 1);
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–æ–ª–Ω—ã
                if (this.enemiesSpawned >= this.wave * this.enemiesPerWave && 
                    this.enemies.length === 0) {
                    this.wave++;
                    this.enemiesSpawned = 0;
                    
                    if (this.audio) {
                        this.audio.play('wave');
                    }
                    
                    // –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ–ª–Ω–æ–≤–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞ (–ü–†–û–ó–†–ê–ß–ù–´–ô!)
                    this.createWaveEffect();
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
                this.updateUI();
            }
            
            createWaveEffect() {
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –≤–æ–ª–Ω–æ–≤–æ–π —ç—Ñ—Ñ–µ–∫—Ç –≤–º–µ—Å—Ç–æ –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π –∫—Ä—É–≥
                        ctx.save();
                        ctx.globalAlpha = 0.3; // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å 30%
                        ctx.strokeStyle = COLORS.BLUE;
                        ctx.lineWidth = 3;
                        ctx.beginPath();
                        ctx.arc(
                            CANVAS_WIDTH / 2,
                            CANVAS_HEIGHT / 2,
                            100 + i * 50,
                            0,
                            Math.PI * 2
                        );
                        ctx.stroke();
                        ctx.restore();
                    }, i * 100);
                }
            }
            
            updateUI() {
                document.getElementById('score').textContent = this.player.score;
                document.getElementById('wave').textContent = this.wave;
                document.getElementById('lives').textContent = this.player.lives;
                document.getElementById('hits').textContent = this.player.hitCounter;
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤
                const bonusesDiv = document.getElementById('bonuses');
                let bonusHTML = '';
                
                if (this.player.octaShotActive) {
                    bonusHTML += '<div class="bonus-item">üéØ –í–û–°–¨–ú–ò–ó–ê–†–Ø–î–ù–´–ô –í–´–°–¢–†–ï–õ: ' + 
                        Math.ceil(this.player.octaShotTimer / 60) + '—Å</div>';
                }
                
                if (this.player.tripleShotActive) {
                    bonusHTML += '<div class="bonus-item">‚ö° –¢–†–û–ô–ù–û–ô –í–´–°–¢–†–ï–õ: ' + 
                        Math.ceil(this.player.tripleShotTimer / 60) + '—Å</div>';
                }
                
                if (!bonusHTML) {
                    bonusHTML = '<div class="bonus-item">üö´ –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤</div>';
                }
                
                bonusesDiv.innerHTML = bonusHTML;
            }
            
            draw() {
                // –û—á–∏—Å—Ç–∫–∞ —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º –¥–ª—è –∑–≤–µ–∑–¥
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∑–≤–µ–∑–¥
                this.stars.forEach(star => {
                    ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                    ctx.fillRect(star.x, star.y, star.size, star.size);
                });
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
                this.particles.forEach(particle => particle.draw());
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
                this.enemies.forEach(enemy => enemy.draw());
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—É–ª—å –≤—Ä–∞–≥–æ–≤
                this.enemyBullets.forEach(bullet => bullet.draw());
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –ø—É–ª—å –∏–≥—Ä–æ–∫–∞
                this.bullets.forEach(bullet => bullet.draw());
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
                this.player.draw();
                
                // –†–∏—Å–æ–≤–∞–Ω–∏–µ UI –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ
                this.drawUI();
            }
            
            drawUI() {
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–∞—É–∑—ã
                if (this.paused) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                    ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                    
                    ctx.fillStyle = COLORS.WHITE;
                    ctx.font = 'bold 48px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('–ü–ê–£–ó–ê', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
                    
                    ctx.font = '24px Arial';
                    ctx.fillText('–ù–∞–∂–º–∏—Ç–µ ESC –∏–ª–∏ –∫–æ—Å–Ω–∏—Ç–µ—Å—å –≤–Ω–µ –∏–≥—Ä—ã', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + 50);
                }
                
                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä Game Over
                if (this.gameOver) {
                    ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                    ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
                    
                    ctx.fillStyle = COLORS.RED;
                    ctx.font = 'bold 48px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('GAME OVER', CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 - 50);
                    
                    ctx.fillStyle = COLORS.WHITE;
                    ctx.font = '24px Arial';
                    ctx.fillText(`–°—á–µ—Ç: ${this.player.score}`, CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2);
                    ctx.fillText(`–í–æ–ª–Ω–∞: ${this.wave}`, CANVAS_WIDTH / 2, CANVAS_HEIGHT / 2 + 40);
                }
            }
            
            gameLoop(timestamp) {
                if (this.gameOver) return;
                
                const deltaTime = timestamp - this.lastTime || 0;
                this.lastTime = timestamp;
                
                if (!this.paused) {
                    this.update();
                    this.draw();
                }
                
                this.frameCount++;
                requestAnimationFrame(this.gameLoop.bind(this));
            }
            
            showGameOver() {
                if (this.audio) {
                    this.audio.play('gameOver');
                    this.audio.stopMusic();
                }
                
                document.getElementById('finalScore').textContent = this.player.score;
                document.getElementById('finalWave').textContent = this.wave;
                document.getElementById('gameOverModal').style.display = 'flex';
            }
        }
        

        async function startGame() {
            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
                console.log('–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...');
                await loadImages();
                console.log('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã...');
            } catch (error) {
                console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:', error);
            }
            
            // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            game = new Game();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –º—É–∑—ã–∫—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã
            if (soundEnabled && game.audio) {
                setTimeout(() => {
                    game.audio.startMusic();
                }, 500);
            }
        }
        
        function restartGame() {
            document.getElementById('gameOverModal').style.display = 'none';
            startGame();
        }
        
        function showInstructions() {
            document.getElementById('instructionsModal').style.display = 'flex';
        }
        
        function hideInstructions() {
            document.getElementById('instructionsModal').style.display = 'none';
        }
        
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundBtn = document.getElementById('soundBtn');
            
            if (soundEnabled) {
                soundBtn.textContent = 'üîä –ó–í–£–ö –í–ö–õ';
                if (game && game.audio) {
                    game.audio.startMusic();
                }
            } else {
                soundBtn.textContent = 'üîá –ó–í–£–ö –í–´–ö–õ';
                if (game && game.audio) {
                    game.audio.stopMusic();
                }
            }
        }
        
        // ======================= –ó–ê–ü–£–°–ö –ò–ì–†–´ =======================
        window.onload = startGame;
    </script>
</body>
</html>
